@{
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
    ViewData["Title"] = "Tổng quan quản trị Cms Cnice";
}

<!-- Content Wrapper. Contains page content -->
<!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
        Tổng quan hệ thống
        <small>phiên bản thử nghiệm</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Trang chủ</a></li>
        <li class="active">Tổng quan</li>
    </ol>
</section>
<!-- Main content -->
<section class="content">
    <!-- Small boxes (Stat box) -->
    <div class="row">
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-aqua">
                <div class="inner">
                    <h3>@ViewBag.Customer</h3>
                    <p>Tài khoản đăng ký</p>
                </div>
                <div class="icon">
                    <i class="ion ion-bag"></i>
                </div>
                <a href="#" class="small-box-footer">Xem danh sách <i class="fa fa-arrow-circle-right"></i></a>
            </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-green">
                <div class="inner">
                    <h3>@ViewBag.Order</h3>
                    <p>Đơn hàng</p>
                </div>
                <div class="icon">
                    <i class="ion ion-stats-bars"></i>
                </div>
                <a href="/Admin/AdminOrder" class="small-box-footer">Xem danh sách <i class="fa fa-arrow-circle-right"></i></a>
            </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-yellow">
                <div class="inner">
                    <h3>@ViewBag.Contact</h3>
                    <p>Liên hệ</p>
                </div>
                <div class="icon">
                    <i class="ion ion-person-add"></i>
                </div>
                <a href="/Admin/AdminContact" class="small-box-footer">Xem danh sách <i class="fa fa-arrow-circle-right"></i></a>
            </div>
        </div>
        <!-- ./col -->
        <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-red">
                <div class="inner">
                    <h3>@ViewBag.Counter</h3>
                    <p>Tổng truy cập</p>
                </div>
                <div class="icon">
                    <i class="ion ion-pie-graph"></i>
                </div>
                <a href="#" class="small-box-footer">Xem chi tiết <i class="fa fa-arrow-circle-right"></i></a>
            </div>
        </div>
        <!-- ./col -->
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">DANH SÁCH SẢN PHẨM</h3>
                    <div class="box-tools">
                        <div class="input-group input-group-sm" style="width: 250px;">
                            <input type="text" id="txtSearch" name="table_search" class="form-control pull-right" placeholder="Tìm kiếm sản phẩm">
                            <div class="input-group-btn">
                                <button type="button" id="search" class="btn btn-default"><i class="fa fa-search"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-body">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Hình</th>
                                <th style="width:50%">Tên bài</th>
                                <th>Ngày tạo</th>
                                <th>Xem thông tin</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody class="load-list"></tbody>
                    </table>
                </div>
                <div class="box-footer clearfix">
                    @*<div class="pull-left">
                            <button type="button" class="btn btn-block btn-danger btn-flat">CẬP NHẬT</button>
                        </div>*@
                    <div class="pull-right">
                        <ul class="pagination pagination-sm no-margin pull-right" id="load-pagination"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- /.content -->
<!-- /.content-wrapper -->

<script>
    var count = 0;
    var txt_class = "";
    function load(txtSearch, page, status) {
        count = 0;
        txt_class = "";
        $.ajax({
            url: '/Admin/News/GetNewsList',
            type: "GET",
            data: { txtSearch: txtSearch, page: page, trang: 10 },
            dataType: 'json',
            contentType: 'application/json;charset=utf-8',
            success: function (result) {
                console.log(result);
                var str = "";
                $.each(result.data, function (index, value) {
                    txt_class = "period_order_" + value.newS_ID;
                    var date = new Date(value.newS_PUBLISHDATE);
                    count = count + 1;
                    str += "<tr>";
                    str += "<td><img src='/UploadImages/Data/News/" + value.newS_ID + "/" + value.newS_IMAGE1 + "' style='width: 56px;' /></td>";
                    str += "<td> <a class='nameCode' href='/Admin/News/Edit/" + value.newS_ID + "'>" + value.newS_TITLE + "</a></td>";
                    str += "<td>" + date.getDate() + '/' + date.getMonth() + '/' + date.getFullYear() + ' ' + date.getHours() + ':' + date.getMinutes() + "</td>";
                    str += "<td><a href='/Admin/News/Edit/" + value.newS_ID + "' class='btn btn-social btn-info btn-xs'><i class='fa fa-pencil'></i> Xem chi tiết</a></td>";
                    str += "<td><a data-id='" + value.newS_ID + "' class='btn btn-success btn-xs UpdateDauTrang'  style='margin-right:10px'><i class='fa fa-fw fa-arrow-circle-up'></i> Lên đầu</a><a data-id='" + value.newS_ID + "' class='btn bg-red btn-xs deleteNews'><i class='glyphicon glyphicon-trash'></i> Xóa</a></td>";
                    str += "</tr>";
                    //create pagination
                    var pagination_string = "";
                    var pageCurrent = result.pageCurrent;
                    var numSize = result.numSize;
                    //create button previous
                    if (pageCurrent > 1) {
                        var pagePrevious = pageCurrent - 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + pagePrevious + '>Previous</a></li>';
                    }
                    for (i = 1; i <= numSize; i++) {
                        if (i == pageCurrent) {
                            pagination_string += '<li class="page-item active"><a href="" class="page-link" data-page=' + i + '>' + pageCurrent + '</a></li>';
                        } else {
                            pagination_string += '<li class="page-item"><a href="" class="page-link" data-page=' + i + '>' + i + '</a></li>';
                        }
                    }
                    //create button next
                    if (pageCurrent > 0 && pageCurrent < numSize) {
                        var pageNext = pageCurrent + 1;
                        pagination_string += '<li class="page-item"><a href="" class="page-link"  data-page=' + pageNext + '>Next</a></li>';
                    }
                    //load pagination
                    $("#load-pagination").html(pagination_string);
                });
                //load str to class="load-list"
                $(".load-list").html(str);
            }
        });
    };

    $(document).ready(function () {
        //function load pagination
        $("body").on("click", ".pagination li a", function (event) {
            event.preventDefault();
            var page = $(this).attr('data-page');

            //load event pagination
            var txtSearch = $(".txtSearch").val();
            if (txtSearch != "") {
                load(txtSearch, page, null)
            }
            else {
                load(null, page, null);
            }
        });

        $("#search").click(function () {
            var txtSearch = $("#txtSearch").val();
            if (txtSearch != "") {
                load(txtSearch, 1, null)
            }
            else {
                load(null, 1, null);
            }
        });

        $("body").on("click", ".deleteNews", function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: "/Admin/News/DeleteNewsId",
                data: {
                    id: $(this).attr("data-id"),
                },
                success: function (result) {
                    if (result == "False") {
                        $('.thongbao').html("Xóa không thành công . Liên hệ kỹ thuật kiểm tra chức năng");
                        $('.alert').show(250).delay(2000).hide(250);
                    }
                    else if (result == "OK") {
                        $('.thongbao').html("Xóa thông tin thành công");
                        $('.alert').show(250).delay(2000).hide(250);
                        load(null, 1, null);
                    }
                }
            });
        });

        $("body").on("click", ".UpdateDauTrang", function (event) {
            event.preventDefault();
            $.ajax({
                type: "POST",
                url: "/Admin/News/UpdateNews",
                data: {
                    id: $(this).attr("data-id"),
                },
                success: function (result) {
                    if (result == "False") {
                        $('.thongbao').html("Cập nhật không thành công");
                        $('.alert').show(250).delay(2000).hide(250);
                    }
                    else if (result == "OK") {
                        $('.thongbao').html("Cập nhật thông tin thành công");
                        $('.alert').show(250).delay(2000).hide(250);
                        load(null, 1, null);
                    }
                }
            });
        });
        //load init
        load(null, 1, null);
    });


</script>
