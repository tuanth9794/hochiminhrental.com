@model IEnumerable<CoreCnice.Domain.ESHOP_CATEGORIES>
@using CoreCnice.Connect;
@using CoreCnice.Domain;
@using CoreCnice.UtilsCs;
@{
    BulSoftCmsConnectContext _context = new BulSoftCmsConnectContext();
    int lang = Utils.CIntDef(ViewBag.Langue);
}

@foreach (var category in Model.ToList().Take(3))
{
    <div class="col-lg-3 col-md-6">
        <div class="f_widget about-widget pl_40">
            @if (lang == 1)
            {
                <h3 class="f-title f_500 t_color f_size_18 mb_20">@Html.Raw(category.CAT_NAME)</h3>
            }
            else
            {
                <h3 class="f-title f_500 t_color f_size_18 mb_20">@Html.Raw(category.CAT_NAME_EN)</h3>
            }
                <ul class="list-unstyled f_list">
                    @{
                        var listNew = (from n in _context.ESHOP_NEWS
                                       join c in _context.ESHOP_NEWS_CAT on n.NEWS_ID equals c.NEWS_ID
                                       join nc in _context.ESHOP_CATEGORIES on c.CAT_ID equals nc.CAT_ID
                                       where c.CAT_ID == category.CAT_ID
                                       select new
                                       {
                                           n.NEWS_ID,
                                           n.NEWS_TITLE,
                                           n.NEWS_TITLE_EN,
                                           n.NEWS_SEO_URL,
                                           nc.CAT_SEO_URL,
                                           n.NEWS_URL,
                                           n.NEWS_SEO_URL_EN,
                                           nc.CAT_SEO_URL_EN

                                       });

                        foreach (var itemn in listNew.ToList())
                        {
                            string linkurl = "";

                            if (lang == 1)
                            {
                                if (!String.IsNullOrEmpty(itemn.NEWS_URL))
                                {
                                    linkurl = itemn.NEWS_URL;
                                }
                                else
                                {
                                    linkurl = "/" + itemn.CAT_SEO_URL + "/" + itemn.NEWS_SEO_URL.Replace("/", "");

                                }
                            }
                            else
                            {
                                if (!String.IsNullOrEmpty(itemn.NEWS_URL))
                                {
                                    linkurl = itemn.NEWS_URL;
                                }
                                else
                                {
                                    linkurl = "/" + itemn.CAT_SEO_URL_EN + "/" + itemn.NEWS_SEO_URL_EN;
                                }
                            }

                            if (lang == 1)
                            {
                                <li><a href="@linkurl" title="@itemn.NEWS_TITLE" rel="nofollow">@itemn.NEWS_TITLE</a></li>
                            }
                            else
                            {
                                <li><a href="@linkurl" title="@itemn.NEWS_TITLE_EN" rel="nofollow">@itemn.NEWS_TITLE_EN</a></li>
                            }
                        }
                    }
                </ul>
        </div>
    </div>
}