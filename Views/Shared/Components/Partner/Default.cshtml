@model IEnumerable<CoreCnice.Domain.ESHOP_CATEGORIES>
@using CoreCnice.Connect;
@using CoreCnice.UtilsCs;
@{
    clsFormat fm = new clsFormat();
    BulSoftCmsConnectContext _context = new BulSoftCmsConnectContext();
    int lang = Utils.CIntDef(ViewBag.Langue);
}

@foreach (var category in Model.ToList())
{
    <section class="security_customers_logo_area bg_color">
        <div class="container">
            <div class="hosting_title analytices_title text-center" style="margin-top:12px;">
                @if (lang == 1)
                {
                    <h2 class="wow fadeInUp"><span>@Html.Raw(category.CAT_NAME)</span> @Html.Raw(category.CAT_CODE)</h2>
                    <p class="wow fadeInUp" data-wow-delay="0.3s">@Html.Raw(category.CAT_DESC)</p>
                }
                else
                {
                    <h2 class="wow fadeInUp"><span>@Html.Raw(category.CAT_NAME_EN)</span> @Html.Raw(category.CAT_CODE)</h2>
                    <p class="wow fadeInUp" data-wow-delay="0.3s">@Html.Raw(category.CAT_DESC_EN)</p>
                }
            </div>
            <div class="security_inner" style="margin-bottom:40px">
                <img class="p_absoulte security_leaf_left wow fadeInDown" data-wow-delay="0.8s" src="~/img/home-security/leaf_clients2.png" alt="">
                <img class="p_absoulte security_leaf_right wow fadeInDown" data-wow-delay="0.8s" src="~/img/home-security/leaf_clients1.png" alt="">
                <div class="bg_row_dt owl-carousel owl-theme">
                    @{
                        var listNew = (from n in _context.ESHOP_NEWS
                                       join c in _context.ESHOP_NEWS_CAT on n.NEWS_ID equals c.NEWS_ID
                                       join cat in _context.ESHOP_CATEGORIES on c.CAT_ID equals cat.CAT_ID
                                       where c.CAT_ID == category.CAT_ID
                                       orderby n.NEWS_ID descending
                                       select new
                                       {
                                           n.NEWS_ID,
                                           n.NEWS_TITLE,
                                           n.NEWS_URL,
                                           n.NEWS_SEO_URL,
                                           n.NEWS_IMAGE1,
                                           n.NEWS_PRICE2,
                                           n.NEWS_PRICE1,
                                           n.NEWS_DESC,
                                           n.NEWS_IMAGE2,
                                           cat.CAT_SEO_URL,
                                           n.NEWS_TITLE_EN,
                                           n.NEWS_DESC_EN
                                       }).Take(16);


                        foreach (var itemn in listNew.ToList().Skip(0).Take(100))
                        {
                            string linkurl = "";

                            if (!String.IsNullOrEmpty(linkurl))
                            {
                                linkurl = itemn.NEWS_URL;
                            }
                            else
                            {
                                linkurl = itemn.CAT_SEO_URL + "/" + itemn.NEWS_SEO_URL;
                            }

                            string linkimg = "";

                            if (!String.IsNullOrEmpty(itemn.NEWS_IMAGE1))
                            {
                                linkimg = "/UploadImages/Data/News/" + itemn.NEWS_ID + "/" + itemn.NEWS_IMAGE1;
                            }
                            else
                            {
                                linkimg = "/images/noimg.jpg";

                            }

                            @if (lang == 1)
                            {
                                <div class="item">
                                    <a href="@linkurl" class="analytices_logo wow fadeInUp"><img src="@linkimg" alt="@Html.Raw(itemn.NEWS_TITLE)"></a>
                                </div>
                            }
                            else
                            {
                                <div class="item">
                                    <a href="@linkurl" class="analytices_logo wow fadeInUp"><img src="@linkimg" alt="@Html.Raw(itemn.NEWS_TITLE_EN)"></a>
                                </div>
                            }
                        }
                    }
                </div>
            </div>
        </div>
    </section>
}

