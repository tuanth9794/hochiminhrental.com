@model IEnumerable<CoreCnice.Domain.ESHOP_CATEGORIES>
@using CoreCnice.Connect;
@using CoreCnice.Domain;
@using CoreCnice.Servicer;
@using CoreCnice.UtilsCs
@{
    BulSoftCmsConnectContext _context = new BulSoftCmsConnectContext();
    CategoryServices ct = new CategoryServices();
    clsFormat cl = new clsFormat();
}

@foreach (var category in Model.ToList())
{
    string LinkUrl = "";

    if (String.IsNullOrEmpty(category.CAT_URL) == true)
    {
        LinkUrl = "/" + category.CAT_SEO_URL;
    }
    else
    {
        LinkUrl = category.CAT_URL;
    }

    <section class="experts_team_area sec_pad" style="background:hsl(0deg 0% 96%)">
        <div class="container">
            <div class="sec_title text-center mb_70">
                <h2 class="f_p f_size_30 l_height30 f_700 t_color3 mb_20 wow fadeInUp" data-wow-delay="0.2s">@Html.Raw(category.CAT_NAME)</h2>
                <p class="f_400 f_size_16 wow fadeInUp" data-wow-delay="0.4s">@Html.Raw(category.CAT_DESC)</p>
            </div>
            <div class="row">
                @{
                    var listNew = (from n in _context.ESHOP_NEWS
                                   join c in _context.ESHOP_NEWS_CAT on n.NEWS_ID equals c.NEWS_ID
                                   join cat in _context.ESHOP_CATEGORIES on c.CAT_ID equals cat.CAT_ID
                                   where c.CAT_ID == category.CAT_ID
                                   orderby n.NEWS_PUBLISHDATE descending
                                   select new
                                   {
                                       n.NEWS_ID,
                                       n.NEWS_TITLE,
                                       n.NEWS_URL,
                                       n.NEWS_SEO_URL,
                                       n.NEWS_IMAGE1,
                                       n.NEWS_DESC,
                                       cat.CAT_SEO_URL,
                                       cat.CAT_NAME,
                                       n.NEWS_PUBLISHDATE
                                   }).Take(4);
                    //int countloop = 0;
                    //int counttt = listNew.ToList().Count;
                    foreach (var itemn in listNew.ToList())
                    {
                        string linkurl = "";

                        if (!String.IsNullOrEmpty(linkurl))
                        {
                            linkurl = itemn.NEWS_URL;
                        }
                        else
                        {
                            linkurl = "/" + itemn.CAT_SEO_URL + "/" + itemn.NEWS_SEO_URL;
                        }

                        string linkimg = "";
                        string linkimgNews = "";
                        if (!String.IsNullOrEmpty(itemn.NEWS_IMAGE1))
                        {
                            linkimg = "/UploadImages/Data/News/" + itemn.NEWS_ID + "/" + itemn.NEWS_IMAGE1;
                            linkimgNews = "/UploadImages/Data/News/" + itemn.NEWS_ID + "/thumb-" + itemn.NEWS_IMAGE1;
                            if (Utils.checkfileExit(linkimgNews) == true)
                            {
                                linkimg = linkimgNews;
                            }
                        }
                        else
                        {
                            linkimg = "/images/noimg.jpg";
                        }

                        <div class="col-lg-3 col-sm-6">
                            <div class="ex_team_item wow fadeInUp" data-wow-delay="0.2s">
                                <img src="@linkimg" alt="@itemn.NEWS_TITLE">
                                <div class="team_content">
                                    <a href="@linkurl">
                                        <h3 class="f_p f_size_16 f_600 t_color3">@Html.Raw(itemn.NEWS_TITLE)</h3>
                                    </a>
                                    <h5>@Html.Raw(itemn.CAT_NAME)</h5>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
            <div class="col-lg-12 text-center">
                <a href="/@category.CAT_SEO_URL" class="learn_btn wow fadeInLeft" data-wow-delay="0.2s" style="visibility: visible; animation-delay: 0.2s; animation-name: fadeInLeft;">Xem thêm tin tức <i class="ti-arrow-right"></i></a>
            </div>
        </div>
    </section>

    <!-- Section: blog -->
}

<style>
    .imgnews {
        object-fit: cover;
        width: 100%;
        height: 215px;
    }

    .entry-title {
        min-height: 52px;
    }
</style>
